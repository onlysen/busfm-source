function KeyHelper(a){var b=$("#keyhelp");a?b.show().animate({top:-10},300):b.animate({top:-290},300,function(){$(this).hide()})}function triggerEggs(){alert("\u5f69\u86cb")}function setWave(a){var b=a||!1;a?$(".wavestatic").removeClass("wavestatic"):$("span.cur").addClass("wavestatic")}function myReflect(a,b){var c=b||!1;b?$(a).reflect():$(a).reflect({height:1.3})}function setSongMeta(a){var b=$("#m-song-meta");if(a){$(".msmeta-title",b).html(a),$(".msmeta-detail",b).html("");return}$(".msmeta-detail",b).html($("#metas").html())}var myPlayList,playItem=0,isie9=$.browser.msie&&$.browser.version=="9.0";$(function(){function getPlayList(isnotinit){var url="/ajax/content";$.get(url,{id:$("#hidchannel").val(),t:(new Date).getMilliseconds()},function(d){skiplock=!1,myPlayList=eval(d),setDefaultSong();var isinit=!0;isnotinit&&(isinit=!1),myPlayList.length>1&&playListInit(autoStart,isinit)})}function playListInit(a,b){a?playListChange(playItem,b):playListConfig(playItem,b)}function playListConfig(a,b){playItem=a;try{$("#jp").jPlayer("setMedia",{mp3:myPlayList[playItem][2]})}catch(c){alert(c.message)}var d=myPlayList[playItem][1],e=myPlayList[playItem][0];$("#s-title").text(d),$("#s-artist").text(myPlayList[playItem][3]),$("#s-album").text(myPlayList[playItem][4]),$("#clipbord .mp3url").val(myPlayList[playItem][6]),$("#fav").data({cursongid:e}),setSongMeta(d),document.title=d+" - \u5df4\u58eb\u7535\u53f0";var f=myPlayList[playItem][5],g=$("#rightcover .cover-img").eq(0).empty().append($("<img/>",{src:"img/loading.gif","class":"loading"})),h=new Image;$(h).load(function(){var a=$(this).attr("title",d).hide();g.empty().append(this),a.fadeIn(1e3,function(){try{$(this).reflect({height:.1,opacity:.2})}catch(a){}})}).error(function(){$("img",g).attr({src:"img/default_l.png",title:d}).removeClass("loading")}).attr({src:f}),$("#clipbord").animate({opacity:"hide"},500),songHistory(b);var i=$("#fav span").removeClass("star");getCookie("member_id")!=""&&($("#hidchannel").val()=="99"?(i.addClass("star"),isie9&&window.external.msIsSiteMode()&&setFavBtnState(!0)):$.get("/ajax/ifsc?id="+e+"&t="+(new Date).getMilliseconds(),function(a){a=="1"&&i.addClass("star"),isie9&&setFavBtnState(a=="1")})),getAPIdata(d,myPlayList[playItem][3],myPlayList[playItem][4])}function songHistory(isinit){if(typeof localStorage=="undefined")return;var sh=[];if(localStorage.songlist!=null){sh=localStorage.songlist;try{sh=eval(sh)}catch(err){sh=[]}}isinit&&sh.length>0&&(arrayUnique(sh),$.each(sh,function(a,b){setLocalStorage(b.split(","))}));var newsong=[];$.each(myPlayList[playItem],function(a,b){newsong.push(b.replace(/,/g,"-"))}),sh.push(newsong.toString()),sh.length>24&&sh.shift(),localStorage.songlist="";for(var i=0;i<sh.length;)localStorage.songlist+='"'+sh[i].toString()+'"',++i<sh.length&&(localStorage.songlist+=",");localStorage.songlist="["+localStorage.songlist+"]";if(!isinit&&sh.length>1){var el=sh[sh.length-2].split(",");setLocalStorage(el)}}function setLocalStorage(a){var b=new Image,c=$("#song-history div");$(b).load(function(){c.filter(function(a){return a<=c.length-4}).remove(),$("#alumn-wall img").length==24&&$("#alumn-wall li:first").html("").appendTo($("#alumn-wall")),t=$(this).css("opacity",.6).appendTo($("#song-history")).reflect({opacity:.2}).clone().data({id:a[0],title:a[1],artist:a[3],album:a[4]}).appendTo($("#alumn-wall li").filter(function(){return $("img",this).length==0}).eq(0))}).error(function(){$(b).attr("src","img/default_m.png")}).attr("src",a[5]).data({id:a[0],title:a[1],artist:a[3],album:a[4]})}function playListChange(a,b){playListConfig(a,b);try{$("#jp").jPlayer("play")}catch(c){alert(c.message)}}function playListNext(){var a;playItem+1<myPlayList.length?(a=playItem+1,playListChange(a)):(autoStart=!0,skiplock=!0,playItem=0,getPlayList(!0))}function playListPrev(){var a=playItem-1>=0?playItem-1:myPlayList.length-1;playListChange(a)}function setDefaultSong(){var a=$("#hidPriPlay");if(a.length>0){var b=[];b.push(a.attr("sid")),b.push($(".hpp_title",a).text()),b.push($(".hpp_url",a).text()),b.push($(".hpp_artist",a).text()),b.push($(".hpp_album",a).text()),b.push($(".hpp_thumb",a).text()),myPlayList.unshift(b),a.remove()}var c=$("#hidchannel").val();$("#channel-list li[cid="+c+"]").addClass("cur")}function setPlay(){$("#jplayer_play").is(":hidden")?($("#jplayer_pause").trigger("click"),keyTip("\u6682\u505c")):($("#jplayer_play").trigger("click"),keyTip("\u64ad\u653e"))}function setVolume(a){a?(curVolume+=.1,curVolume>1&&(curVolume=1)):(curVolume-=.1,curVolume<0&&(curVolume=0)),$("#jp").jPlayer("volume",curVolume)}function keyTip(a){$("#keyaction").text(a).show().stop(!0,!0).animate({opacity:1},1e3,function(){$(this).animate({opacity:0},500,function(){$(this).hide()})})}function getAPIdata(a,b,c){var d=encodeURIComponent(a+", "+b+", "+c),e="",f=$("#metas").html(e),g=!1,h='http://query.yahooapis.com/v1/public/yql?q=select * from music.track.search where keyword="'+d+'"';$.get(h,{format:"json",diagnostics:"false"},function(i){if(i.query.count>0){var j=i.query.results.Track;$.isArray(j)&&(j=j[0]),e+="&copy;&nbsp;"+j.releaseYear+"&nbsp;"+(j.label||""),j.Category!=undefined&&(e+="<br/>"+parseGenres(j.Category)),e+="<br/>Album: ",j.Album!=null&&(e+="<a href='"+j.Album.Release.url+"' target='_blank'>Yahoo</a>")}else g=!0,songdebug(1,a);h="http://api.douban.com/music/subjects?q="+d,$.get(h,{alt:"xd","max-results":"1"},function(a){a.entry.length>0&&checkDouban(a.entry[0],b,c)&&(g&&(e+=parseDoubanAttr(a.entry[0]["db:attribute"])+"<br/>Album: "),e+="<a href='"+a.entry[0].link[1]["@href"]+"' target='_blank'>Douban</a>"),f.html(e),setSongMeta()},"jsonp"),f.html(e)},"jsonp")}function parseGenres(a){var b="Categories: ";if($.isArray(a))for(var c=0;c<a.length;)b+=a[c].name,++c<a.length&&(b+=", ");else b+=a.name;return b}function parseDoubanAttr(a){var b=p="";return $.each(a,function(a,c){c["@name"]=="pubdate"&&(b=c.$t.replace(/-.*/g,"")),c["@name"]=="publisher"&&(p=c.$t)}),"&copy;&nbsp;"+b+"&nbsp;"+p}function checkDouban(a,b,c){if(a.title.$t.toLowerCase()!=c.toLowerCase())return songdebug(2,c,a.title.$t),!1;var d=a.author,e=!1;return $.each(d,function(a,c){var d=c.name.$t.toLowerCase(),g=b.toLowerCase();if(d.search(g)>-1||g.search(d)>-1)e=!0}),e?!0:(songdebug(2,b,d[0].name.$t),!1)}function songdebug(a,b,c){typeof localStorage!="undefined"&&(localStorage.removeItem("yahoo"),localStorage.removeItem("douban"))}var curVolume=.8,autoStart=!0,skiplock=!0;$("#jp").jPlayer({ready:function(){getPlayList()},ended:function(){playListNext()},timeupdate:function(a){$(".j-seek-bar").width(a.jPlayer.status.seekPercent+"%"),$(".j-play-bar").width(a.jPlayer.status.currentPercentAbsolute+"%")},pause:function(){setWave()},play:function(){setWave(!0)},error:function(a){a.jPlayer.error.type==$.jPlayer.error.URL&&playListNext()},preload:"auto",solution:"html,flash",backgroundColor:"transparent",supplied:"mp3",warningAlerts:!0,errorAlerts:!1,cssSelector:{play:"#jplayer_play",pause:"#jplayer_pause",stop:"#jplayer_stop",currentTime:"#pt",duration:"#tt",volumeBar:"#jplayer_vbar",volumeBarValue:"#vamount"},cssSelectorAncestor:"",swfPath:"/js"}),$("#jplayer_vbar,#jpalyer_v_wrap").click(function(a){var b=$(this),c=b.offset(),d=a.clientX-c.left;curVolume=d/b.width(),b.is("#jpalyer_v_wrap")&&$("#jp").jPlayer("volume",curVolume);if(curVolume>0){var e=$("#jplayer_vmin span");e.is(".mute")&&e.removeClass("mute")}}),$("#jplayer_vmin").click(function(){var a=$("span",this);return a.is(".mute")?($("#jp").jPlayer("volume",curVolume),a.removeClass("mute")):($("#jp").jPlayer("volume",0),a.addClass("mute")),!1}),$("#player").mousewheel(function(a,b){curVolume=curVolume+b*.05;var c=$("#jplayer_vmin span");if(curVolume<0){curVolume=0,$("#jp").jPlayer("mute"),c.addClass("mute");return}return c.is(".mute")&&($("#jp").jPlayer("unmute"),c.removeClass("mute")),curVolume>1&&(curVolume=1),$("#jp").jPlayer("volume",curVolume),!1}),$("#jplayer_pause,#jplayer_play").click(function(){isie9&&window.external.msIsSiteMode()&&setPlayBtnState($("#jplayer_pause").is(":hidden"))}),$("#jplayer_next").click(function(){if(skiplock)return;return playListNext(),!1}),$("#channellist span").live("click",function(){var a=$(this),b=a.attr("cid");if(a.is(".cur"))return;if(b=="99"&&getCookie("member_id")=="")return;$(".wavestatic").removeClass("wavestatic"),$("#hidchannel").val(b),$(".cur").removeClass("cur"),a.addClass("cur"),autoStart=!0,getPlayList(!0)}),$("#khclose").click(function(){KeyHelper()}),$("#keyhelp").click(function(a){a.stopPropagation()}),$("body").not("#keyhelp").not("#openkeydialog").click(function(){KeyHelper()}),$("#openkeydialog").click(function(a){KeyHelper($("#keyhelp").is(":hidden")),a.stopPropagation()}),$("*").live("keydown",function(a){a.stopPropagation();var b=$(this),c=a.which;if(b.is(":input")||b.is("textarea"))return;c==38&&$.isEmptyObject($("body").data("egg"))&&($("body").data({egg:"|"}),setTimeout(function(){$("body").removeData("egg")},2e3));if(!$.isEmptyObject($("body").data("egg"))){var d=$("body").data("egg")+"|"+c;d=="||38|38|40|40|37|39|37|39|66|65"?(triggerEggs(),$("body").removeData("egg")):$("body").data({egg:d})}var e=$("<input/>",{type:"text",style:"width:0;border:none;color:transparent;"}).appendTo("body").focus();setTimeout(function(){e.remove()},300);if(c==38||c==39||c==40||c==80)if(!a.shiftKey)return;switch(c){case 32:case 80:setPlay();break;case 70:$("#fav").trigger("click"),keyTip("\u6536\u85cf");break;case 83:$("#clipbord").is(":hidden")&&keyTip("\u5206\u4eab"),$("#share").trigger("click");break;case 39:case 78:$("#jplayer_next").trigger("click"),keyTip("\u4e0b\u4e00\u66f2");break;case 85:case 38:setVolume(!0),keyTip("\u97f3\u91cf\u589e");break;case 68:case 40:setVolume(),keyTip("\u97f3\u91cf\u51cf");break;case 77:$("#jplayer_vmin").trigger("click"),$("#jplayer_vmin span").is(".mute")?keyTip("\u9759\u97f3\u5f00"):keyTip("\u9759\u97f3\u5173");break;case 191:KeyHelper($("#keyhelp").is(":hidden"));break;case 87:$("#box-main").is(":hidden")&&getCookie("member_id")!=""&&$("#diarybox").trigger("click");break;case 27:KeyHelper(!1);break;default:}}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){var b=this.length,c=Number(arguments[1]);isNaN(c)?c=b-1:(c=c<0?Math.ceil(c):Math.floor(c),c<0?c+=b:c>=b&&(c=b-1));for(;c>-1;c--)if(c in this&&this[c]===a)return c;return-1})})